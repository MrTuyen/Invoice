@using SAB.Common
@{
    ViewBag.Title = "Lịch sử mua hàng";
    ViewBag.Description = "Danh sách";
}


<div class="scrollable-content" ng-controller="CustomerController">
    <div ng-show="isLoading" class="app-content-loading" style="text-align: center;">
        <img class="loading-spinner" src="~/Content/img/loading.gif" />
    </div>
    <div class="form-signin" ng-hide="isLoading">
        <div class="row">
            <div class="col-md-2">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="Mã, số đt khách hàng" ng-model="keywords" />
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group">
                    <select multiple="multiple" id="ddlStore" name="lstStoreID" style="width: 100%">
                        @foreach (StoreModel p in (ViewBag.Stores) as IEnumerable<StoreModel>)
                        {
                            <option value="@p.STOREID">@p.STOREID - @p.STORENAME</option>
                        }
                    </select>
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group">
                    <input type="text" style="height:35px; width:100%;" name="txtFromDate" id="txtFromDate" class="datepicker" ng-model="txtFromDate" placeholder="Xuất từ ngày" />
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group">
                    <input type="text" style="height:35px; width:100%;" name="txtToDate" id="txtToDate" class="datepicker" ng-model="txtToDate" placeholder="Đến ngày" />
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group">
                    <button type="button" class="btn btn-warning btn-block" ng-click="Search()">
                        <span class="fa fa-search"></span> Tìm kiếm
                    </button>
                </div>
            </div>
            <div class="col-md-2">
                <div class="form-group">
                    <button type="button" class="btn btn-success btn-block" ng-click="ExportExcelReport()" ng-show="ListOutput != null && ListOutput.length >= 0">
                        <span class="fa fa-file-excel-o "></span> Xuất Excel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <table class="table table-striped table-bordered" ng-show="ListOutput != null && ListOutput.length >= 0">
        <thead>
            <tr>
                <th class="text-center">Mã phiếu xuất</th>
                <th style="width: 100px;" class="text-center">Ngày xuất</th>
                <th class="text-center">Cửa hàng xuất</th>
                <th class="text-center" style="width: 90px; line-height: 16px;">Tổng tiền</th>
                <th class="text-center" style="width: 90px; line-height: 16px;">Giảm theo hóa đơn</th>
                <th class="text-center" style="width: 90px; line-height: 16px;">Phải thu</th>
                <th class="text-center" style="width: 90px; line-height: 16px;">Tiền cà thẻ</th>
                <th class="text-center" style="width: 90px; line-height: 16px;">AppCode</th>
                <th class="text-center" style="width: 90px; line-height: 16px;">Tiền mặt</th>
                <th class="text-center" style="width: 100px;">Khách hàng</th>
                <th class="text-center">Nhân viên xuất</th>
            </tr>
        </thead>
        <tbody>
            <tr class="gradeX" ng-repeat="p in ListOutput">
                <td class="text-center text-green">{{p.OUTPUTVOUCHERID}}</td>
                <td class="text-center">{{p.OUTPUTDATE | dateTimeFormat}}</td>
                <td><strong>{{p.STOREID}}</strong> - {{p.STORENAME}}</td>
                <td class="text-right">{{p.TOTALAMOUNT | numberFormat:0}}</td>
                <td class="text-right">{{p.TOTALVOUCHERDISCOUNT | numberFormat:0}}</td>
                <td class="text-right"><strong>{{(p.TOTALAMOUNT - p.TOTALVOUCHERDISCOUNT) | numberFormat:0}}</strong></td>
                <td class="text-right">{{p.MONEYCARD | numberFormat:0}}</td>
                <td class="text-center">{{p.MONEYCARDVOUCHERID}}</td>
                <td class="text-right">{{(p.CASHVND - p.REFUNDMONEY) | numberFormat:0}}</td>
                <td>{{p.CUSTOMERNAME}}</td>
                <td>{{p.OUTPUTUSER}} - {{p.FULLNAME}}</td>
            </tr>
            <tr class="gradeX" style="font-weight:bold; font-size: 20px">
                <td colspan="6">
                    Tổng số phiếu xuất: <span class="text-red">{{ListOutput.length}}</span>,
                    Tổng tiền trước giảm: <span class="text-red">{{ListOutput|sumTotal:'TOTALAMOUNT'|numberFormat:0}}</span>
                    <p>Tổng giảm theo hóa đơn: <span class="text-red">{{ListOutput|sumTotal:'TOTALVOUCHERDISCOUNT'|numberFormat:0}}</span></p>
                </td>
                <td colspan="3">
                    <p>Tổng tiền phải thu: <span class="text-red">{{ListOutput|totalWithOperation:'TOTALAMOUNT':'TOTALVOUCHERDISCOUNT':'-'|numberFormat:0}}</span></p>
                    <p>Tổng tiền thẻ: <span class="text-red">{{ListOutput|sumTotal:'MONEYCARD'|numberFormat:0}}</span></p>
                    <p>Tổng tiền mặt:<span class="text-red">{{ListOutput|totalWithOperation:'CASHVND':'REFUNDMONEY':'-'|numberFormat:0}}</span></p>
                </td>

            </tr>
        </tbody>
    </table>
</div>