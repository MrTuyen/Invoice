app.controller("AccountController",["$scope","$timeout","CommonFactory",function(n,t,i){var r="/Account/";n.Login=function(){if(!n.UserName)return n.ErrorMessge="Vui lòng cho biết tên đăng nhập của bạn.",!1;if(!n.Password)return n.ErrorMessge="Vui lòng nhập mật khẩu của bạn.",!1;var t=r+"UnauthorisedRequest",u=JSON.stringify({username:n.UserName,password:n.Password});n.isLoading=!0;i.PostDataAjax(t,u,function(t){t?t.rs?window.location.href="/":(n.isLoading=!1,n.ErrorMessge=t.msg):(n.isLoading=!1,alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - Login"))})};n.PressEnter=function(t){t.keyCode==13&&n.Login()};n.ChangePass=function(){if(n.password==null||n.password=="")return alert("Vui lòng nhập mật khẩu hiện tại của bạn."),!1;if(n.newpassword==null||n.newpassword=="")return alert("Vui lòng nhập mật khẩu mới."),!1;if(n.renewpassword==null||n.renewpassword=="")return alert("Vui lòng nhập lại mật khẩu mới."),!1;var t=r+"ChangePassword",u=JSON.stringify({password:n.password,newpassword:n.newpassword,renewpassword:n.renewpassword});n.isLoading=!0;i.PostDataAjax(t,u,function(t){t?t.rs?(alert(t.msg),window.location.href="/"):n.ErrorMessge=t.msg:alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - Login");n.isLoading=!1})}}]);app.controller("ManagerController",["$scope","$timeout","$filter","CommonFactory",function(n,t,i,r){var u="/Manager/",f;n.InvoiceType=[{Key:0,Value:"Hóa đơn giá trị gia tăng"},{Key:1,Value:"Hóa đơn trường học"},{Key:2,Value:"Hóa đơn tiền điện"},{Key:3,Value:"Hóa đơn bán hàng"},{Key:4,Value:"Hóa đơn tiền nước"},{Key:5,Value:"Phiếu xuất kho kiêm vận chuyển nội bộ"}];n.currentPage=1;n.GetCompany=function(t){t||(t=1);t>n.TotalPages&&(t=n.TotalPages);n.currentPage=t;var i=u+"GetCompany",f=JSON.stringify({keyword:n.Keywords,currentPage:n.currentPage});n.isLoading=!0;r.PostDataAjax(i,f,function(t){t?t.rs?(n.ListCompany=t.result,n.TotalPages=t.TotalPages):(n.ErrorMessge=t.msg,alert(t.msg)):(n.isLoading=!1,alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - GetCompany"))})};n.BackToListCompany=function(){n.Company={};n.Company.ISEDIT=!1};n.ReloadDataPage=function(){n.GetAllReleaseNotice(n.currentPage);n.GetAllUserByComtaxCode(n.currentPage)};n.EditCompany=function(i){let r=[];if(n.Company={},n.Company.ISNEW=!0,i){if(n.SelectedInvoiceType=i.USINGINVOICETYPETMP,angular.copy(i,n.Company),n.Company.USINGINVOICETYPETMP){let t=n.Company.USINGINVOICETYPETMP.split(",").filter(function(t){let i=n.InvoiceType.filter(function(n){return n.Key.toString()===t})[0].Value;r.push(i)});$("#ddlPro").selectpicker({title:r.join()}).selectpicker("render");$("#ddlPro").selectpicker("refresh")}n.Company.ARRUSINGTYPETMP=n.Company.USINGINVOICETYPETMP}t(function(){n.Company.ISEDIT=!0;n.ReloadDataPage()},100)};n.SaveCompany=function(){if(!n.Company){alert("Vui lòng nhập vào thông tin doanh nghiệp.");return}if(!n.Company.COMNAME){alert("Vui lòng nhập tên doanh nghiệp.");return}if(!n.Company.COMTAXCODE){alert("Vui lòng nhập mã số thuế doanh nghiệp.");return}if(!n.Company.ARRUSINGTYPETMP&&!n.Company.USINGINVOICETYPETMP){alert("Vui lòng chọn loại hóa đơn.");return}if(Array.isArray(n.Company.ARRUSINGTYPETMP)){let t=n.Company.ARRUSINGTYPETMP.join();n.Company.ARRUSINGTYPETMP=t}var t=u+"UpdateEnterpriseInfo",i=JSON.stringify({enterprise:n.Company});n.isLoading=!0;r.PostDataAjax(t,i,function(t){t?t.rs?(alert("Thành công!"),n.GetCompany(1),n.Company={},n.Company.ISEDIT=!1):alert("Thất bại, vui lòng thử lại!"):alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - SaveCompany")})};n.GetAllUserByComtaxCode=function(){var t=u+"GetAllUserByComtaxCode",i=JSON.stringify({comtaxcode:n.Company.COMTAXCODE});n.isLoading=!0;r.PostDataAjax(t,i,function(t){t?t.rs?n.ListUser=t.result:(n.ErrorMessge=t.msg,alert(t.msg)):(n.isLoading=!1,alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - GetAllUserByComtaxCode"))})};n.GetAllReleaseNotice=function(t){n.FormNumber={};t||(t=1);t>n.TotalPages&&(t=n.TotalPages);n.FormNumber.COMTAXCODE=n.Company.COMTAXCODE;n.FormNumber.ITEMPERPAGE=10;n.FormNumber.CURRENTPAGE=t;var i=u+"GetAllReleaseNotice",f=JSON.stringify({form:n.FormNumber});n.ListNumber=[];r.PostDataAjax(i,f,function(t){t?t.rs?n.ListNumber=t.result:(n.ErrorMessge=t.msg,alert(t.msg)):alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - GetAllReleaseNotice")})};n.EditUser=function(t){n.User={};n.User.ISNEW=!0;n.User.COMTAXCODE=n.Company.COMTAXCODE;t&&angular.copy(t,n.User);n.User.PASSWORD="";n.User.ISEDIT=!0;$("#modal_user_edit").dialog({width:"24%",modal:!0,resizable:!1,create:function(){$("#modal_user_edit").show()}})};n.EditReleaseNotice=function(t){n.ISRELEASENOTICEEDIT=!1;n.ReleaseNotice={};n.ReleaseNotice.COMTAXCODE=n.Company.COMTAXCODE;n.ReleaseNotice.STATUS=4;t&&(angular.copy(t,n.ReleaseNotice),n.ISRELEASENOTICEEDIT=!0,n.ReleaseNotice.OLDFROMNUMBER=t.FROMNUMBER,n.ReleaseNotice.OLDTONUMBER=t.TONUMBER);n.ReleaseNotice.STRFROMTIME=i("dateFormat")(n.ReleaseNotice.FROMTIME,"dd/MM/yyyy");$("#modal_release_notice").dialog({width:"45%",modal:!0,resizable:!1,create:function(){$("#modal_release_notice").show()}})};n.CloseModalDialog=function(){n.User={};n.ReleaseNotice={};$("#modal_user").closest(".ui-dialog-content").dialog("close");$("#modal_release_notice").closest(".ui-dialog-content").dialog("close");$("#modal_invoice").closest(".ui-dialog-content").dialog("close")};n.AddReleaseNotice=function(){var t=u+"AddReleaseNotice",i=JSON.stringify({invoiceNumber:n.ReleaseNotice});r.PostDataAjax(t,i,function(t){t?t.rs?(alert("Thành công"),$("#modal_release_notice").dialog("close"),n.ReloadDataPage()):(n.ErrorMessge=t.msg,alert(t.msg)):alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - SaveReleaseNotice")})};n.SaveReleaseNotice=function(){var t=u+"SaveReleaseNotice",i=JSON.stringify({invoiceNumber:n.ReleaseNotice});r.PostDataAjax(t,i,function(t){t?t.rs?(alert("Thành công"),$("#modal_release_notice").dialog("close"),n.ReloadDataPage()):(n.ErrorMessge=t.msg,alert(t.msg)):alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - SaveReleaseNotice")})};n.SaveUser=function(t,i){var f,e;if(t.EMAIL===""){alert("Vui lòng nhập địa chỉ email.");return}if(t.COMTAXCODE===""){alert("Không tồn tại MST doanh nghiệp.");return}f=u+"AddUser";i&&(f=u+"UpdateUser");e=JSON.stringify({account:t});r.PostDataAjax(f,e,function(t){typeof item!="string"&&(t?t.rs?(alert("Thành công"),$("#modal_user").dialog("close"),n.ReloadDataPage()):(n.ErrorMessge=t.msg,alert(t.msg)):alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - SaveUser"))})};n.DeleteUser=function(t){var i=function(i){if(!i)return!1;var f=u+"DeleteUser",e=JSON.stringify({account:t});r.PostDataAjax(f,e,function(t){t?t.rs?(alert("Thành công"),n.ReloadDataPage()):(n.ErrorMessge=t.msg,alert(t.msg)):alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - DeleteUser")})};confirm("Bạn có chắc không","Xóa tài khoản quản lý","Bỏ qua","Đồng ý",i)};n.DeleteReleaseNotice=function(t){var i=function(i){if(!i)return!1;var f=u+"DeleteReleaseNotice",e=JSON.stringify({releaseNotice:t});r.PostDataAjax(f,e,function(t){t?t.rs?(alert("Cập nhật thành công"),n.ReloadDataPage()):(n.ErrorMessge=t.msg,alert(t.msg)):alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - DeleteUser")})};confirm("Bạn có chắc chắn muốn xóa thông báo phát hành cho mẫu số <b>"+t.FORMCODE+"<\/b>, ký hiệu <b>"+t.SYMBOLCODE+"<\/b> từ số <b>"+t.FROMNUMBER+"<\/b> đến số <b>"+t.TONUMBER+"<\/b>.<br/><br/>Bấm <b>Đồng ý<\/b> để xóa, bấm <b>Bỏ qua<\/b> để giữ nguyên trạng thái","Xóa thông báo phát hành","Bỏ qua","Đồng ý",i)};n.GetInvoice=function(t){t||(t=1);t>n.TotalPages&&(t=n.TotalPages);n.currentPage=t;var i=u+"GetInvoice",f=JSON.stringify({keyword:n.Keywords,currentPage:n.currentPage});n.isLoading=!0;r.PostDataAjax(i,f,function(t){t?t.rs?(n.ListInvoice=t.result,n.TotalPages=t.TotalPages):(n.ErrorMessge=t.msg,alert(t.msg)):(n.isLoading=!1,alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - GetInvoice"))})};n.BackToListInvoice=function(){n.Invoice={}};n.ReloadDataPage=function(){n.GetAllReleaseNotice(n.currentPage);n.GetAllUserByComtaxCode(n.currentPage)};n.EditInvoice=function(t){n.Invoice={};n.Invoice.ISNEW=!0;n.Invoice.COMTAXCODE=n.Company.COMTAXCODE;t&&angular.copy(t,n.Invoice);n.Invoice.ISEDIT=!0;$("#modal_invoice_edit").dialog({width:"650px",modal:!0,resizable:!1,create:function(){$("#modal_invoice_edit").show()}})};n.SaveInvoice=function(){var t,i,f;if(!n.Invoice.INVOICEWATING){alert("Vui lòng chọn cập nhật trạng thái hóa đơn hoặc dải chờ.");return}if(!n.Invoice.COMTAXCODE){alert("Vui lòng nhập mã số thuế doanh nghiệp.");return}if(!n.Invoice.NUMBER&&n.Invoice.INVOICEWATING==1){alert("Vui lòng nhập số HĐ cần cập nhật.");return}if(!n.Invoice.NUMBER&&n.Invoice.INVOICEWATING==2){alert("Vui lòng nhập số HĐ chờ bắt đầu.");return}if(!n.Invoice.NUMBERTEMP&&n.Invoice.INVOICEWATING==2){alert("Vui lòng nhập số HĐ chờ kết thúc .");return}if(!n.Invoice.FORMCODE){alert("Vui lòng nhập mẫu số.");return}if(!n.Invoice.SYMBOLCODE){alert("Vui lòng nhập ký hiệu.");return}if(!n.Invoice.INVOICESTATUS&&n.Invoice.INVOICEWATING==1){alert("Vui chọn trạng thái.");return}t="Cập nhật trạng thái HĐ thành công!";n.Invoice.INVOICEWATING==2&&(t="Thêm mới dải chờ thành công");i=u+"UpdateInvoiceStatus";f=JSON.stringify({invoice:n.Invoice});n.isLoading=!0;r.PostDataAjax(i,f,function(i){i?i.rs?(alert(t),$("#modal_invoice_edit").dialog("close"),n.GetInvoice(1),n.Invoice={},n.Invoice.ISEDIT=!1):alert("Thất bại, vui lòng thử lại!"):alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - SaveInvoice")})};n.Getforstatistics=function(t){LoadingShow();t||(t=1);t>n.TotalPages&&(t=n.TotalPages);n.currentPage=t;var i=u+"Getforstatistics",f=JSON.stringify({keyword:n.Keywords,currentPage:n.currentPage,statuscus:n.Statuscus});n.isLoading=!0;r.PostDataAjax(i,f,function(t){t?t.rs?(n.ListInvoice=t.result,n.TotalPages=t.TotalPages,n.TotalCusAll=t.TotalCusAll,n.TotalCusFee=t.TotalCusFee,n.TotalCusFree=t.TotalCusFree,n.TotalCusActive=t.TotalCusActive,n.TotalCusNoActive=t.TotalCusNoActive):(n.ErrorMessge=t.msg,alert(t.msg)):(n.isLoading=!1,alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - Getforstatistics"));LoadingHide()})};n.GetStatisticTopTen=function(t){if(LoadingShow(),n.Statistic.STATUS==="6"&&!n.Statistic.FROMTIME&&!n.Statistic.TOTIME){LoadingHide();return}t||(t=1);t>n.TotalPages&&(t=n.TotalPages);n.currentPage=t;var i=u+"GetStatisticTopTen",f=JSON.stringify({statistic:n.Statistic,currentPage:n.currentPage});n.isLoading=!0;r.PostDataAjax(i,f,function(t){t?t.rs?n.ListInvoice=t.result:(n.ErrorMessge=t.msg,alert(t.msg)):(n.isLoading=!1,alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - Getforstatistics"));LoadingHide()})};n.ChangStatusUser=function(t,i,f){var e="Đã kích hoạt thành công",o,s;f==!0&&(e="Đã vô hiệu hóa thành công");o=u+"ChangStatusUser";s=JSON.stringify({comtaxcode:t,email:i,actived:f});r.PostDataAjax(o,s,function(t){t?t.rs?(alert(e),n.Company.ISEDIT=!0,n.ReloadDataPage()):n.ErrorMessage=t.msg:alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - ChangStatusUser")})};f=function(){var t=u+"GetSumany";r.PostDataAjax(t,null,function(t){t&&(t.rs?(n.TotalCusAll=t.result.TOTAL,n.TotalCusFee=t.result.TOTAL-t.result.FREETRIAL,n.TotalCusActive=t.result.COUNTUSED,n.TotalNotYetActive=t.result.TOTAL-t.result.COUNTUSED,n.TotalWaitingPublic=t.result.WAITINGPUBLIC):n.ErrorMessage=t.msg)})};f()}]);app.controller("InfoComController",["$scope","$timeout","$filter","CommonFactory",function(n,t,i,r){var u="/InfoCom/";n.currentPage=1;n.Init=function(t){t||(t=1);t>n.TotalPages&&(t=n.TotalPages);var i=u+"Init",f=JSON.stringify({keyword:null,itemPerPage:20,currentPage:t});n.isLoading=!0;r.PostDataAjax(i,f,function(t){t?t.rs?n.ListCompany=t.result:(n.ErrorMessge=t.msg,alert(t.msg)):(n.isLoading=!1,alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - GetCompany"))})};n.BackToListCompany=function(){n.Company={};n.Company.ISEDIT=!1};n.ReloadDataPage=function(){n.GetAllReleaseNotice(n.currentPage);n.GetAllUserByComtaxCode(n.currentPage)};n.EditCompany=function(i){n.Company={};n.Company.ISNEW=!0;i&&angular.copy(i,n.Company);t(function(){n.Company.ISEDIT=!0;n.ReloadDataPage()},100)};n.SaveCompany=function(){if(!n.Company){alert("Vui lòng nhập vào thông tin doanh nghiệp.");return}if(!n.Company.COMNAME){alert("Vui lòng nhập tên doanh nghiệp.");return}if(!n.Company.COMTAXCODE){alert("Vui lòng nhập mã số thuế doanh nghiệp.");return}if(!n.Company.COMADDRESS){alert("Vui lòng nhập địa chỉ doanh nghiệp.");return}var t=u+"UpdateEnterpriseInfo",i=JSON.stringify({enterprise:n.Company});n.isLoading=!0;r.PostDataAjax(t,i,function(t){t?t.rs?(alert("Thành công!"),n.GetCompany(1),n.Company.ISNEW&&(n.User={},n.User.EMAIL=n.Company.EMAIL,n.User.USERNAME=n.Company.EMAIL,n.User.PHONENUMBER=n.Company.COMPHONENUMBER,n.User.COMTAXCODE=n.Company.COMTAXCODE,n.User.PASSWORD=n.Company.COMTAXCODE,n.SaveUser("auto")),n.Company={},n.Company.ISEDIT=!1):alert("Thất bại, vui lòng thử lại!"):alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - SaveCompany")})};n.GetAllUserByComtaxCode=function(){var t=u+"GetAllUserByComtaxCode",i=JSON.stringify({comtaxcode:n.Company.COMTAXCODE});n.isLoading=!0;r.PostDataAjax(t,i,function(t){t?t.rs?n.ListUser=t.result:(n.ErrorMessge=t.msg,alert(t.msg)):(n.isLoading=!1,alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - GetAllUserByComtaxCode"))})};n.GetAllReleaseNotice=function(t){n.FormNumber={};t||(t=1);t>n.TotalPages&&(t=n.TotalPages);n.FormNumber.COMTAXCODE=n.Company.COMTAXCODE;n.FormNumber.ITEMPERPAGE=10;n.FormNumber.CURRENTPAGE=t;var i=u+"GetAllReleaseNotice",f=JSON.stringify({form:n.FormNumber});n.ListNumber=[];r.PostDataAjax(i,f,function(t){t?t.rs?n.ListNumber=t.result:(n.ErrorMessge=t.msg,alert(t.msg)):alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - GetAllReleaseNotice")})};n.EditUser=function(t){n.User={};n.User.ISNEW=!0;n.User.COMTAXCODE=n.Company.COMTAXCODE;t&&angular.copy(t,n.User);n.User.PASSWORD="";n.User.ISEDIT=!0;$("#modal_user").dialog({width:"25%",modal:!0,resizable:!1,create:function(){$("#modal_user").show()}})};n.EditReleaseNotice=function(t){n.ReleaseNotice={};n.ReleaseNotice.COMTAXCODE=n.Company.COMTAXCODE;n.ReleaseNotice.STATUS=4;t&&angular.copy(t,n.ReleaseNotice);n.ReleaseNotice.STRFROMTIME=i("dateFormat")(n.ReleaseNotice.FROMTIME,"dd/MM/yyyy");$("#modal_release_notice").dialog({width:"45%",modal:!0,resizable:!1,create:function(){$("#modal_release_notice").show()}})};n.CloseModalDialog=function(){n.User={};n.ReleaseNotice={};$("#modal_user").dialog("close");$("#modal_release_notice").dialog("close")};n.SaveReleaseNotice=function(){var t=u+"AddReleaseNotice",i=JSON.stringify({invoiceNumber:n.ReleaseNotice});r.PostDataAjax(t,i,function(t){t?t.rs?(alert("Thành công"),$("#modal_release_notice").dialog("close"),n.ReloadDataPage()):(n.ErrorMessge=t.msg,alert(t.msg)):alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - SaveReleaseNotice")})};n.SaveUser=function(t){var i=u+"AddUser",f=JSON.stringify({account:t});r.PostDataAjax(i,f,function(t){typeof item!="string"&&(t?t.rs?(alert("Thành công"),$("#modal_user").dialog("close"),n.ReloadDataPage()):(n.ErrorMessge=t.msg,alert(t.msg)):alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - SaveUser"))})};n.DeleteUser=function(t){var e=function(n){if(!n)return!1;window.open("NOVAON_FOLDER"+item.SIGNLINKTEMP)},i,f;confirm("Sau khi xóa user khỏi doanh nghiệp <b>"+t.COMTAXCODE+"<\/b> sẽ trở về mặc định thuộc mã số thuế <b>0106579683-999<\/b>. Bấm <b>Đồng ý<\/b> để chuyển sang mặc định, bấm <b>Bỏ qua<\/b> để giữ nguyên trạng thái","Set User Default","Bỏ qua","Đồng ý",e);t.COMTAXCODE="0106579683-999";i=u+"AddUser";f=JSON.stringify({account:t});r.PostDataAjax(i,f,function(t){t?t.rs?(alert("Thành công"),n.ReloadDataPage()):(n.ErrorMessge=t.msg,alert(t.msg)):alert("Không nhận được phản hồi từ máy chủ, vui lòng thử lại (js) - DeleteUser")})}}]);